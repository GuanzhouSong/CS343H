<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>./trackingTestClasses.py</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><span class="hl slc"># trackingTestClasses.py</span>
<span class="hl slc"># ----------------------</span>
<span class="hl slc"># Licensing Information:  You are free to use or extend these projects for </span>
<span class="hl slc"># educational purposes provided that (1) you do not distribute or publish </span>
<span class="hl slc"># solutions, (2) you retain this notice, and (3) you provide clear </span>
<span class="hl slc"># attribution to UC Berkeley, including a link to </span>
<span class="hl slc"># http://inst.eecs.berkeley.edu/~cs188/pacman/pacman.html</span>
<span class="hl slc"># </span>
<span class="hl slc"># Attribution Information: The Pacman AI projects were developed at UC Berkeley.</span>
<span class="hl slc"># The core projects and autograders were primarily created by John DeNero </span>
<span class="hl slc"># (denero&#64;cs.berkeley.edu) and Dan Klein (klein&#64;cs.berkeley.edu).</span>
<span class="hl slc"># Student side autograding was added by Brad Miller, Nick Hay, and </span>
<span class="hl slc"># Pieter Abbeel (pabbeel&#64;cs.berkeley.edu).</span>


<span class="hl slc"># trackingTestClasses.py</span>
<span class="hl slc"># ----------------------</span>
<span class="hl slc"># Licensing Information: Please do not distribute or publish solutions to this</span>
<span class="hl slc"># project. You are free to use and extend these projects for educational</span>
<span class="hl slc"># purposes. The Pacman AI projects were developed at UC Berkeley, primarily by</span>
<span class="hl slc"># John DeNero (denero&#64;cs.berkeley.edu) and Dan Klein (klein&#64;cs.berkeley.edu).</span>
<span class="hl slc"># Student side autograding was added by Brad Miller, Nick Hay, and Pieter</span>
<span class="hl slc"># Abbeel in Spring 2013.</span>
<span class="hl slc"># For more info, see http://inst.eecs.berkeley.edu/~cs188/pacman/pacman.html</span>

<span class="hl kwa">import</span> testClasses
<span class="hl kwa">import</span> busters
<span class="hl kwa">import</span> layout
<span class="hl kwa">import</span> bustersAgents
<span class="hl kwa">from</span> game <span class="hl kwa">import</span> Agent
<span class="hl kwa">from</span> game <span class="hl kwa">import</span> Actions
<span class="hl kwa">from</span> game <span class="hl kwa">import</span> Directions
<span class="hl kwa">import</span> random
<span class="hl kwa">import</span> time
<span class="hl kwa">import</span> util
<span class="hl kwa">import</span> json
<span class="hl kwa">import</span> re
<span class="hl kwa">import</span> copy
<span class="hl kwa">from</span> util <span class="hl kwa">import</span> manhattanDistance

<span class="hl kwa">class</span> <span class="hl kwd">GameScoreTest</span><span class="hl opt">(</span>testClasses<span class="hl opt">.</span>TestCase<span class="hl opt">):</span>

    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span>self<span class="hl opt">,</span> question<span class="hl opt">,</span> testDict<span class="hl opt">):</span>
        <span class="hl kwb">super</span><span class="hl opt">(</span>GameScoreTest<span class="hl opt">,</span> self<span class="hl opt">).</span><span class="hl kwd">__init__</span><span class="hl opt">(</span>question<span class="hl opt">,</span> testDict<span class="hl opt">)</span>
        self<span class="hl opt">.</span>maxMoves <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'maxMoves'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>inference <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">]</span>
        self<span class="hl opt">.</span>layout_str <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'layout_str'</span><span class="hl opt">].</span><span class="hl kwd">split</span><span class="hl opt">(</span><span class="hl str">'</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        self<span class="hl opt">.</span>numRuns <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'numRuns'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>numWinsForCredit <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'numWinsForCredit'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>numGhosts <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'numGhosts'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>layout_name <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'layout_name'</span><span class="hl opt">]</span>
        self<span class="hl opt">.</span>min_score <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'min_score'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>observe_enable <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'observe'</span><span class="hl opt">] ==</span> <span class="hl str">'True'</span>
        self<span class="hl opt">.</span>elapse_enable <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'elapse'</span><span class="hl opt">] ==</span> <span class="hl str">'True'</span>

    <span class="hl kwa">def</span> <span class="hl kwd">execute</span><span class="hl opt">(</span>self<span class="hl opt">,</span> grades<span class="hl opt">,</span> moduleDict<span class="hl opt">,</span> solutionDict<span class="hl opt">):</span>
        ghosts <span class="hl opt">= [</span><span class="hl kwd">SeededRandomGhostAgent</span><span class="hl opt">(</span>i<span class="hl opt">)</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">,</span>self<span class="hl opt">.</span>numGhosts<span class="hl opt">+</span><span class="hl num">1</span><span class="hl opt">)]</span>
        pac <span class="hl opt">=</span> bustersAgents<span class="hl opt">.</span><span class="hl kwd">GreedyBustersAgent</span><span class="hl opt">(</span><span class="hl num">0</span><span class="hl opt">,</span> inference <span class="hl opt">=</span> self<span class="hl opt">.</span>inference<span class="hl opt">,</span> ghostAgents <span class="hl opt">=</span> ghosts<span class="hl opt">,</span> observeEnable <span class="hl opt">=</span> self<span class="hl opt">.</span>observe_enable<span class="hl opt">,</span> elapseTimeEnable <span class="hl opt">=</span> self<span class="hl opt">.</span>elapse_enable<span class="hl opt">)</span>
        <span class="hl slc">#if self.inference == &quot;ExactInference&quot;:</span>
        <span class="hl slc">#    pac.inferenceModules = [moduleDict['inference'].ExactInference(a) for a in ghosts]</span>
        <span class="hl slc">#else:</span>
        <span class="hl slc">#    print &quot;Error inference type %s -- not implemented&quot; % self.inference</span>
        <span class="hl slc">#    return</span>

        stats <span class="hl opt">=</span> <span class="hl kwd">run</span><span class="hl opt">(</span>self<span class="hl opt">.</span>layout_str<span class="hl opt">,</span> pac<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> self<span class="hl opt">.</span>question<span class="hl opt">.</span><span class="hl kwd">getDisplay</span><span class="hl opt">(),</span> nGames<span class="hl opt">=</span>self<span class="hl opt">.</span>numRuns<span class="hl opt">,</span> maxMoves<span class="hl opt">=</span>self<span class="hl opt">.</span>maxMoves<span class="hl opt">,</span> quiet <span class="hl opt">=</span> <span class="hl kwa">False</span><span class="hl opt">)</span>
        aboveCount <span class="hl opt">= [</span>s <span class="hl opt">&gt;=</span> self<span class="hl opt">.</span>min_score <span class="hl kwa">for</span> s <span class="hl kwa">in</span> stats<span class="hl opt">[</span><span class="hl str">'scores'</span><span class="hl opt">]].</span><span class="hl kwd">count</span><span class="hl opt">(</span><span class="hl kwa">True</span><span class="hl opt">)</span>
        msg <span class="hl opt">=</span> <span class="hl str">&quot;%s) Games won on %s with score above %d: %d/%d&quot;</span> <span class="hl opt">% (</span>self<span class="hl opt">.</span>layout_name<span class="hl opt">,</span> grades<span class="hl opt">.</span>currentQuestion<span class="hl opt">,</span> self<span class="hl opt">.</span>min_score<span class="hl opt">,</span> aboveCount<span class="hl opt">,</span> self<span class="hl opt">.</span>numRuns<span class="hl opt">)</span>
        grades<span class="hl opt">.</span><span class="hl kwd">addMessage</span><span class="hl opt">(</span>msg<span class="hl opt">)</span>
        <span class="hl kwa">if</span> aboveCount <span class="hl opt">&gt;=</span> self<span class="hl opt">.</span>numWinsForCredit<span class="hl opt">:</span>
            grades<span class="hl opt">.</span><span class="hl kwd">assignFullCredit</span><span class="hl opt">()</span>
            <span class="hl kwa">return</span> self<span class="hl opt">.</span><span class="hl kwd">testPass</span><span class="hl opt">(</span>grades<span class="hl opt">)</span>
        <span class="hl kwa">else</span><span class="hl opt">:</span>
            <span class="hl kwa">return</span> self<span class="hl opt">.</span><span class="hl kwd">testFail</span><span class="hl opt">(</span>grades<span class="hl opt">)</span>

    <span class="hl kwa">def</span> <span class="hl kwd">writeSolution</span><span class="hl opt">(</span>self<span class="hl opt">,</span> moduleDict<span class="hl opt">,</span> filePath<span class="hl opt">):</span>
        handle <span class="hl opt">=</span> <span class="hl kwb">open</span><span class="hl opt">(</span>filePath<span class="hl opt">,</span> <span class="hl str">'w'</span><span class="hl opt">)</span>
        handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'# You must win at least %d/10 games with at least %d points'</span> <span class="hl opt">% (</span>self<span class="hl opt">.</span>numWinsForCredit<span class="hl opt">,</span> self<span class="hl opt">.</span>min_score<span class="hl opt">))</span>
        handle<span class="hl opt">.</span><span class="hl kwd">close</span><span class="hl opt">()</span>

    <span class="hl kwa">def</span> <span class="hl kwd">createPublicVersion</span><span class="hl opt">(</span>self<span class="hl opt">):</span>
        <span class="hl kwa">pass</span>

<span class="hl kwa">class</span> <span class="hl kwd">ZeroWeightTest</span><span class="hl opt">(</span>testClasses<span class="hl opt">.</span>TestCase<span class="hl opt">):</span>

    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span>self<span class="hl opt">,</span> question<span class="hl opt">,</span> testDict<span class="hl opt">):</span>
        <span class="hl kwb">super</span><span class="hl opt">(</span>ZeroWeightTest<span class="hl opt">,</span> self<span class="hl opt">).</span><span class="hl kwd">__init__</span><span class="hl opt">(</span>question<span class="hl opt">,</span> testDict<span class="hl opt">)</span>
        self<span class="hl opt">.</span>maxMoves <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'maxMoves'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>inference <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">]</span>
        self<span class="hl opt">.</span>layout_str <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'layout'</span><span class="hl opt">].</span><span class="hl kwd">split</span><span class="hl opt">(</span><span class="hl str">'</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        self<span class="hl opt">.</span>numGhosts <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'numGhosts'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>observe_enable <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'observe'</span><span class="hl opt">] ==</span> <span class="hl str">'True'</span>
        self<span class="hl opt">.</span>elapse_enable <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'elapse'</span><span class="hl opt">] ==</span> <span class="hl str">'True'</span>
        self<span class="hl opt">.</span>ghost <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'ghost'</span><span class="hl opt">]</span>
        self<span class="hl opt">.</span>seed <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'seed'</span><span class="hl opt">])</span>

    <span class="hl kwa">def</span> <span class="hl kwd">execute</span><span class="hl opt">(</span>self<span class="hl opt">,</span> grades<span class="hl opt">,</span> moduleDict<span class="hl opt">,</span> solutionDict<span class="hl opt">):</span>
        random<span class="hl opt">.</span><span class="hl kwd">seed</span><span class="hl opt">(</span>self<span class="hl opt">.</span>seed<span class="hl opt">)</span>
        inferenceFunction <span class="hl opt">=</span> <span class="hl kwb">getattr</span><span class="hl opt">(</span>moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">],</span> self<span class="hl opt">.</span>inference<span class="hl opt">)</span>
        ghosts <span class="hl opt">= [</span><span class="hl kwb">globals</span><span class="hl opt">()[</span>self<span class="hl opt">.</span>ghost<span class="hl opt">](</span>i<span class="hl opt">)</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">,</span> self<span class="hl opt">.</span>numGhosts<span class="hl opt">+</span><span class="hl num">1</span><span class="hl opt">)]</span>
        <span class="hl kwa">if</span> self<span class="hl opt">.</span>inference <span class="hl opt">==</span> <span class="hl str">'MarginalInference'</span><span class="hl opt">:</span>
            moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span>jointInference <span class="hl opt">=</span> moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span><span class="hl kwd">JointParticleFilter</span><span class="hl opt">()</span>
        disp <span class="hl opt">=</span> self<span class="hl opt">.</span>question<span class="hl opt">.</span><span class="hl kwd">getDisplay</span><span class="hl opt">()</span>
        pac <span class="hl opt">=</span> <span class="hl kwd">ZeroWeightAgent</span><span class="hl opt">(</span>inferenceFunction<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> grades<span class="hl opt">,</span> self<span class="hl opt">.</span>seed<span class="hl opt">,</span> disp<span class="hl opt">,</span> elapse<span class="hl opt">=</span>self<span class="hl opt">.</span>elapse_enable<span class="hl opt">,</span> observe<span class="hl opt">=</span>self<span class="hl opt">.</span>observe_enable<span class="hl opt">)</span>
        <span class="hl kwa">if</span> self<span class="hl opt">.</span>inference <span class="hl opt">==</span> <span class="hl str">&quot;ParticleFilter&quot;</span><span class="hl opt">:</span>
            <span class="hl kwa">for</span> pfilter <span class="hl kwa">in</span> pac<span class="hl opt">.</span>inferenceModules<span class="hl opt">:</span> pfilter<span class="hl opt">.</span><span class="hl kwd">setNumParticles</span><span class="hl opt">(</span><span class="hl num">5000</span><span class="hl opt">)</span>
        <span class="hl kwa">elif</span> self<span class="hl opt">.</span>inference <span class="hl opt">==</span> <span class="hl str">&quot;MarginalInference&quot;</span><span class="hl opt">:</span>
            moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span>jointInference<span class="hl opt">.</span><span class="hl kwd">setNumParticles</span><span class="hl opt">(</span><span class="hl num">5000</span><span class="hl opt">)</span>
        <span class="hl kwd">run</span><span class="hl opt">(</span>self<span class="hl opt">.</span>layout_str<span class="hl opt">,</span> pac<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> disp<span class="hl opt">,</span> maxMoves <span class="hl opt">=</span> self<span class="hl opt">.</span>maxMoves<span class="hl opt">)</span>
        <span class="hl kwa">if</span> pac<span class="hl opt">.</span><span class="hl kwd">getReset</span><span class="hl opt">():</span>
            grades<span class="hl opt">.</span><span class="hl kwd">addMessage</span><span class="hl opt">(</span><span class="hl str">'%s) successfully handled all weights = 0'</span> <span class="hl opt">%</span> grades<span class="hl opt">.</span>currentQuestion<span class="hl opt">)</span>
            <span class="hl kwa">return</span> self<span class="hl opt">.</span><span class="hl kwd">testPass</span><span class="hl opt">(</span>grades<span class="hl opt">)</span>
        <span class="hl kwa">else</span><span class="hl opt">:</span>
            grades<span class="hl opt">.</span><span class="hl kwd">addMessage</span><span class="hl opt">(</span><span class="hl str">'%s) error handling all weights = 0'</span> <span class="hl opt">%</span> grades<span class="hl opt">.</span>currentQuestion<span class="hl opt">)</span>
            <span class="hl kwa">return</span> self<span class="hl opt">.</span><span class="hl kwd">testFail</span><span class="hl opt">(</span>grades<span class="hl opt">)</span>

    <span class="hl kwa">def</span> <span class="hl kwd">writeSolution</span><span class="hl opt">(</span>self<span class="hl opt">,</span> moduleDict<span class="hl opt">,</span> filePath<span class="hl opt">):</span>
        handle <span class="hl opt">=</span> <span class="hl kwb">open</span><span class="hl opt">(</span>filePath<span class="hl opt">,</span> <span class="hl str">'w'</span><span class="hl opt">)</span>
        handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'# This test checks that you successfully handle the case when all particle weights are set to 0</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        handle<span class="hl opt">.</span><span class="hl kwd">close</span><span class="hl opt">()</span>

    <span class="hl kwa">def</span> <span class="hl kwd">createPublicVersion</span><span class="hl opt">(</span>self<span class="hl opt">):</span>
        self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'seed'</span><span class="hl opt">] =</span> <span class="hl str">'188'</span>
        self<span class="hl opt">.</span>seed <span class="hl opt">=</span> <span class="hl num">188</span>

<span class="hl kwa">class</span> <span class="hl kwd">DoubleInferenceAgentTest</span><span class="hl opt">(</span>testClasses<span class="hl opt">.</span>TestCase<span class="hl opt">):</span>

    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span>self<span class="hl opt">,</span> question<span class="hl opt">,</span> testDict<span class="hl opt">):</span>
        <span class="hl kwb">super</span><span class="hl opt">(</span>DoubleInferenceAgentTest<span class="hl opt">,</span> self<span class="hl opt">).</span><span class="hl kwd">__init__</span><span class="hl opt">(</span>question<span class="hl opt">,</span> testDict<span class="hl opt">)</span>
        self<span class="hl opt">.</span>seed <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'seed'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>layout_str <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'layout'</span><span class="hl opt">].</span><span class="hl kwd">split</span><span class="hl opt">(</span><span class="hl str">'</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        self<span class="hl opt">.</span>observe <span class="hl opt">= (</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'observe'</span><span class="hl opt">] ==</span> <span class="hl str">&quot;True&quot;</span><span class="hl opt">)</span>
        self<span class="hl opt">.</span>elapse <span class="hl opt">= (</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'elapse'</span><span class="hl opt">] ==</span> <span class="hl str">&quot;True&quot;</span><span class="hl opt">)</span>
        self<span class="hl opt">.</span>checkUniform <span class="hl opt">= (</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'checkUniform'</span><span class="hl opt">] ==</span> <span class="hl str">'True'</span><span class="hl opt">)</span>
        self<span class="hl opt">.</span>maxMoves <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'maxMoves'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>numGhosts <span class="hl opt">=</span> <span class="hl kwb">int</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'numGhosts'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>inference <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">]</span>
        self<span class="hl opt">.</span>errorMsg <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'errorMsg'</span><span class="hl opt">]</span>
        self<span class="hl opt">.</span>L2Tolerance <span class="hl opt">=</span> <span class="hl kwb">float</span><span class="hl opt">(</span>self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'L2Tolerance'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>ghost <span class="hl opt">=</span> self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'ghost'</span><span class="hl opt">]</span>

    <span class="hl kwa">def</span> <span class="hl kwd">execute</span><span class="hl opt">(</span>self<span class="hl opt">,</span> grades<span class="hl opt">,</span> moduleDict<span class="hl opt">,</span> solutionDict<span class="hl opt">):</span>
        random<span class="hl opt">.</span><span class="hl kwd">seed</span><span class="hl opt">(</span>self<span class="hl opt">.</span>seed<span class="hl opt">)</span>
        lines <span class="hl opt">=</span> solutionDict<span class="hl opt">[</span><span class="hl str">'correctActions'</span><span class="hl opt">].</span><span class="hl kwd">split</span><span class="hl opt">(</span><span class="hl str">'</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        moves <span class="hl opt">= []</span>
        <span class="hl slc"># Collect solutions</span>
        <span class="hl kwa">for</span> l <span class="hl kwa">in</span> lines<span class="hl opt">:</span>
            m <span class="hl opt">=</span> re<span class="hl opt">.</span><span class="hl kwd">match</span><span class="hl opt">(</span><span class="hl str">'(\d+) (\w+) (.*)'</span><span class="hl opt">,</span> l<span class="hl opt">)</span>
            moves<span class="hl opt">.</span><span class="hl kwd">append</span><span class="hl opt">((</span>m<span class="hl opt">.</span><span class="hl kwd">group</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">),</span> m<span class="hl opt">.</span><span class="hl kwd">group</span><span class="hl opt">(</span><span class="hl num">2</span><span class="hl opt">),</span> <span class="hl kwb">eval</span><span class="hl opt">(</span>m<span class="hl opt">.</span><span class="hl kwd">group</span><span class="hl opt">(</span><span class="hl num">3</span><span class="hl opt">))))</span>

        inferenceFunction <span class="hl opt">=</span> <span class="hl kwb">getattr</span><span class="hl opt">(</span>moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">],</span> self<span class="hl opt">.</span>inference<span class="hl opt">)</span>

        ghosts <span class="hl opt">= [</span><span class="hl kwb">globals</span><span class="hl opt">()[</span>self<span class="hl opt">.</span>ghost<span class="hl opt">](</span>i<span class="hl opt">)</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">,</span> self<span class="hl opt">.</span>numGhosts<span class="hl opt">+</span><span class="hl num">1</span><span class="hl opt">)]</span>
        <span class="hl kwa">if</span> self<span class="hl opt">.</span>inference <span class="hl opt">==</span> <span class="hl str">'MarginalInference'</span><span class="hl opt">:</span>
            moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span>jointInference <span class="hl opt">=</span> moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span><span class="hl kwd">JointParticleFilter</span><span class="hl opt">()</span>

        disp <span class="hl opt">=</span> self<span class="hl opt">.</span>question<span class="hl opt">.</span><span class="hl kwd">getDisplay</span><span class="hl opt">()</span>
        pac <span class="hl opt">=</span> <span class="hl kwd">DoubleInferenceAgent</span><span class="hl opt">(</span>inferenceFunction<span class="hl opt">,</span> moves<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> grades<span class="hl opt">,</span> self<span class="hl opt">.</span>seed<span class="hl opt">,</span> disp<span class="hl opt">,</span> elapse<span class="hl opt">=</span>self<span class="hl opt">.</span>elapse<span class="hl opt">,</span> observe<span class="hl opt">=</span>self<span class="hl opt">.</span>observe<span class="hl opt">,</span> L2Tolerance<span class="hl opt">=</span>self<span class="hl opt">.</span>L2Tolerance<span class="hl opt">,</span> checkUniform <span class="hl opt">=</span> self<span class="hl opt">.</span>checkUniform<span class="hl opt">)</span>
        <span class="hl kwa">if</span> self<span class="hl opt">.</span>inference <span class="hl opt">==</span> <span class="hl str">&quot;ParticleFilter&quot;</span><span class="hl opt">:</span>
            <span class="hl kwa">for</span> pfilter <span class="hl kwa">in</span> pac<span class="hl opt">.</span>inferenceModules<span class="hl opt">:</span> pfilter<span class="hl opt">.</span><span class="hl kwd">setNumParticles</span><span class="hl opt">(</span><span class="hl num">5000</span><span class="hl opt">)</span>
        <span class="hl kwa">elif</span> self<span class="hl opt">.</span>inference <span class="hl opt">==</span> <span class="hl str">&quot;MarginalInference&quot;</span><span class="hl opt">:</span>
            moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span>jointInference<span class="hl opt">.</span><span class="hl kwd">setNumParticles</span><span class="hl opt">(</span><span class="hl num">5000</span><span class="hl opt">)</span>
        <span class="hl kwd">run</span><span class="hl opt">(</span>self<span class="hl opt">.</span>layout_str<span class="hl opt">,</span> pac<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> disp<span class="hl opt">,</span> maxMoves<span class="hl opt">=</span>self<span class="hl opt">.</span>maxMoves<span class="hl opt">)</span>
        msg <span class="hl opt">=</span> self<span class="hl opt">.</span>errorMsg <span class="hl opt">%</span> pac<span class="hl opt">.</span>errors
        grades<span class="hl opt">.</span><span class="hl kwd">addMessage</span><span class="hl opt">((</span><span class="hl str">&quot;%s) &quot;</span> <span class="hl opt">% (</span>grades<span class="hl opt">.</span>currentQuestion<span class="hl opt">))+</span>msg<span class="hl opt">)</span>
        <span class="hl kwa">if</span> pac<span class="hl opt">.</span>errors <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl opt">:</span>
            grades<span class="hl opt">.</span><span class="hl kwd">addPoints</span><span class="hl opt">(</span><span class="hl num">2</span><span class="hl opt">)</span>
            <span class="hl kwa">return</span> self<span class="hl opt">.</span><span class="hl kwd">testPass</span><span class="hl opt">(</span>grades<span class="hl opt">)</span>
        <span class="hl kwa">else</span><span class="hl opt">:</span>
            <span class="hl kwa">return</span> self<span class="hl opt">.</span><span class="hl kwd">testFail</span><span class="hl opt">(</span>grades<span class="hl opt">)</span>

    <span class="hl kwa">def</span> <span class="hl kwd">writeSolution</span><span class="hl opt">(</span>self<span class="hl opt">,</span> moduleDict<span class="hl opt">,</span> filePath<span class="hl opt">):</span>
        random<span class="hl opt">.</span><span class="hl kwd">seed</span><span class="hl opt">(</span>self<span class="hl opt">.</span>seed<span class="hl opt">)</span>
        <span class="hl kwa">if</span> self<span class="hl opt">.</span>inference <span class="hl opt">==</span> <span class="hl str">'ParticleFilter'</span><span class="hl opt">:</span>
            self<span class="hl opt">.</span>inference <span class="hl opt">=</span> <span class="hl str">'ExactInference'</span>  <span class="hl slc"># use exact inference to generate solution</span>
        inferenceFunction <span class="hl opt">=</span> <span class="hl kwb">getattr</span><span class="hl opt">(</span>moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">],</span> self<span class="hl opt">.</span>inference<span class="hl opt">)</span>

        ghosts <span class="hl opt">= [</span><span class="hl kwb">globals</span><span class="hl opt">()[</span>self<span class="hl opt">.</span>ghost<span class="hl opt">](</span>i<span class="hl opt">)</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">,</span> self<span class="hl opt">.</span>numGhosts<span class="hl opt">+</span><span class="hl num">1</span><span class="hl opt">)]</span>
        <span class="hl kwa">if</span> self<span class="hl opt">.</span>inference <span class="hl opt">==</span> <span class="hl str">'MarginalInference'</span><span class="hl opt">:</span>
            moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span>jointInference <span class="hl opt">=</span> moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span><span class="hl kwd">JointParticleFilter</span><span class="hl opt">()</span>
            moduleDict<span class="hl opt">[</span><span class="hl str">'inference'</span><span class="hl opt">].</span>jointInference<span class="hl opt">.</span><span class="hl kwd">setNumParticles</span><span class="hl opt">(</span><span class="hl num">5000</span><span class="hl opt">)</span>

        pac <span class="hl opt">=</span> <span class="hl kwd">InferenceAgent</span><span class="hl opt">(</span>inferenceFunction<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> self<span class="hl opt">.</span>seed<span class="hl opt">,</span> elapse<span class="hl opt">=</span>self<span class="hl opt">.</span>elapse<span class="hl opt">,</span> observe<span class="hl opt">=</span>self<span class="hl opt">.</span>observe<span class="hl opt">)</span>
        <span class="hl kwd">run</span><span class="hl opt">(</span>self<span class="hl opt">.</span>layout_str<span class="hl opt">,</span> pac<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> self<span class="hl opt">.</span>question<span class="hl opt">.</span><span class="hl kwd">getDisplay</span><span class="hl opt">(),</span> maxMoves<span class="hl opt">=</span>self<span class="hl opt">.</span>maxMoves<span class="hl opt">)</span>
        <span class="hl slc"># run our gold code here and then write it to a solution file</span>
        answerList <span class="hl opt">=</span> pac<span class="hl opt">.</span>answerList
        handle <span class="hl opt">=</span> <span class="hl kwb">open</span><span class="hl opt">(</span>filePath<span class="hl opt">,</span> <span class="hl str">'w'</span><span class="hl opt">)</span>
        handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'# move_number action likelihood_dictionary</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'correctActions: &quot;&quot;&quot;</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        <span class="hl kwa">for</span> <span class="hl opt">(</span>moveNum<span class="hl opt">,</span> move<span class="hl opt">,</span> dists<span class="hl opt">)</span> <span class="hl kwa">in</span> answerList<span class="hl opt">:</span>
            handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'%s %s ['</span> <span class="hl opt">% (</span>moveNum<span class="hl opt">,</span> move<span class="hl opt">))</span>
            <span class="hl kwa">for</span> dist <span class="hl kwa">in</span> dists<span class="hl opt">:</span>
                handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'{'</span><span class="hl opt">)</span>
                <span class="hl kwa">for</span> key <span class="hl kwa">in</span> dist<span class="hl opt">:</span>
                    handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'%s: %s, '</span> <span class="hl opt">% (</span>key<span class="hl opt">,</span> dist<span class="hl opt">[</span>key<span class="hl opt">]))</span>
                handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'}, '</span><span class="hl opt">)</span>
            handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">']</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        handle<span class="hl opt">.</span><span class="hl kwd">write</span><span class="hl opt">(</span><span class="hl str">'&quot;&quot;&quot;</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">)</span>
        handle<span class="hl opt">.</span><span class="hl kwd">close</span><span class="hl opt">()</span>

    <span class="hl kwa">def</span> <span class="hl kwd">createPublicVersion</span><span class="hl opt">(</span>self<span class="hl opt">):</span>
        self<span class="hl opt">.</span>testDict<span class="hl opt">[</span><span class="hl str">'seed'</span><span class="hl opt">] =</span> <span class="hl str">'188'</span>
        self<span class="hl opt">.</span>seed <span class="hl opt">=</span> <span class="hl num">188</span>

<span class="hl kwa">def</span> <span class="hl kwd">run</span><span class="hl opt">(</span>layout_str<span class="hl opt">,</span> pac<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> disp<span class="hl opt">,</span> nGames <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">,</span> name <span class="hl opt">=</span> <span class="hl str">'games'</span><span class="hl opt">,</span> maxMoves<span class="hl opt">=-</span><span class="hl num">1</span><span class="hl opt">,</span> quiet <span class="hl opt">=</span> <span class="hl kwa">True</span><span class="hl opt">):</span>
    <span class="hl str">&quot;Runs a few games and outputs their statistics.&quot;</span>

    starttime <span class="hl opt">=</span> time<span class="hl opt">.</span><span class="hl kwd">time</span><span class="hl opt">()</span>
    lay <span class="hl opt">=</span> layout<span class="hl opt">.</span><span class="hl kwd">Layout</span><span class="hl opt">(</span>layout_str<span class="hl opt">)</span>

    <span class="hl slc">#print '*** Running %s on' % name, layname,'%d time(s).' % nGames</span>
    games <span class="hl opt">=</span> busters<span class="hl opt">.</span><span class="hl kwd">runGames</span><span class="hl opt">(</span>lay<span class="hl opt">,</span> pac<span class="hl opt">,</span> ghosts<span class="hl opt">,</span> disp<span class="hl opt">,</span> nGames<span class="hl opt">,</span> maxMoves<span class="hl opt">)</span>

    <span class="hl slc">#print '*** Finished running %s on' % name, layname, 'after %d seconds.' % (time.time() - starttime)</span>

    stats <span class="hl opt">= {</span><span class="hl str">'time'</span><span class="hl opt">:</span> time<span class="hl opt">.</span><span class="hl kwd">time</span><span class="hl opt">() -</span> starttime<span class="hl opt">,</span> \
      <span class="hl str">'wins'</span><span class="hl opt">: [</span>g<span class="hl opt">.</span>state<span class="hl opt">.</span><span class="hl kwd">isWin</span><span class="hl opt">()</span> <span class="hl kwa">for</span> g <span class="hl kwa">in</span> games<span class="hl opt">].</span><span class="hl kwd">count</span><span class="hl opt">(</span><span class="hl kwa">True</span><span class="hl opt">),</span> \
      <span class="hl str">'games'</span><span class="hl opt">:</span> games<span class="hl opt">,</span> <span class="hl str">'scores'</span><span class="hl opt">: [</span>g<span class="hl opt">.</span>state<span class="hl opt">.</span><span class="hl kwd">getScore</span><span class="hl opt">()</span> <span class="hl kwa">for</span> g <span class="hl kwa">in</span> games<span class="hl opt">]}</span>
    statTuple <span class="hl opt">= (</span>stats<span class="hl opt">[</span><span class="hl str">'wins'</span><span class="hl opt">],</span> <span class="hl kwb">len</span><span class="hl opt">(</span>games<span class="hl opt">),</span> <span class="hl kwb">sum</span><span class="hl opt">(</span>stats<span class="hl opt">[</span><span class="hl str">'scores'</span><span class="hl opt">]) *</span> <span class="hl num">1.0</span> <span class="hl opt">/</span> <span class="hl kwb">len</span><span class="hl opt">(</span>games<span class="hl opt">))</span>
    <span class="hl kwa">if not</span> quiet<span class="hl opt">:</span>
        <span class="hl kwa">print</span> <span class="hl str">'*** Won %d out of %d games. Average score: %f ***'</span> <span class="hl opt">%</span> statTuple
    <span class="hl kwa">return</span> stats

<span class="hl kwa">class</span> <span class="hl kwd">InferenceAgent</span><span class="hl opt">(</span>bustersAgents<span class="hl opt">.</span>BustersAgent<span class="hl opt">):</span>
    <span class="hl str">&quot;Tracks ghosts and compares to reference inference modules, while moving randomly&quot;</span>

    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span> self<span class="hl opt">,</span> inference<span class="hl opt">,</span> ghostAgents<span class="hl opt">,</span> seed<span class="hl opt">,</span> elapse<span class="hl opt">=</span><span class="hl kwa">True</span><span class="hl opt">,</span> observe<span class="hl opt">=</span><span class="hl kwa">True</span><span class="hl opt">,</span> burnIn<span class="hl opt">=</span><span class="hl num">0</span><span class="hl opt">):</span>
        self<span class="hl opt">.</span>inferenceModules <span class="hl opt">= [</span><span class="hl kwd">inference</span><span class="hl opt">(</span>a<span class="hl opt">)</span> <span class="hl kwa">for</span> a <span class="hl kwa">in</span> ghostAgents<span class="hl opt">]</span>
        self<span class="hl opt">.</span>elapse <span class="hl opt">=</span> elapse
        self<span class="hl opt">.</span>observe <span class="hl opt">=</span> observe
        self<span class="hl opt">.</span>burnIn <span class="hl opt">=</span> burnIn
        self<span class="hl opt">.</span>numMoves <span class="hl opt">=</span> <span class="hl num">0</span>
        <span class="hl slc">#self.rand = rand</span>
        <span class="hl slc"># list of tuples (move_num, move, [dist_1, dist_2, ...])</span>
        self<span class="hl opt">.</span>answerList <span class="hl opt">= []</span>
        self<span class="hl opt">.</span>seed <span class="hl opt">=</span> seed

    <span class="hl kwa">def</span> <span class="hl kwd">final</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        distributionList <span class="hl opt">= []</span>
        self<span class="hl opt">.</span>numMoves <span class="hl opt">+=</span> <span class="hl num">1</span>
        <span class="hl kwa">for</span> index<span class="hl opt">,</span>inf <span class="hl kwa">in</span> <span class="hl kwb">enumerate</span><span class="hl opt">(</span>self<span class="hl opt">.</span>inferenceModules<span class="hl opt">):</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>observe<span class="hl opt">:</span>
                inf<span class="hl opt">.</span><span class="hl kwd">observeState</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
            self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">[</span>index<span class="hl opt">] =</span> inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">()</span>
            beliefCopy <span class="hl opt">=</span> copy<span class="hl opt">.</span><span class="hl kwd">deepcopy</span><span class="hl opt">(</span>self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">[</span>index<span class="hl opt">])</span>
            distributionList<span class="hl opt">.</span><span class="hl kwd">append</span><span class="hl opt">(</span>beliefCopy<span class="hl opt">)</span>
        self<span class="hl opt">.</span>answerList<span class="hl opt">.</span><span class="hl kwd">append</span><span class="hl opt">((</span>self<span class="hl opt">.</span>numMoves<span class="hl opt">,</span> <span class="hl kwa">None</span><span class="hl opt">,</span> distributionList<span class="hl opt">))</span>
        random<span class="hl opt">.</span><span class="hl kwd">seed</span><span class="hl opt">(</span>self<span class="hl opt">.</span>seed <span class="hl opt">+</span> self<span class="hl opt">.</span>numMoves<span class="hl opt">)</span>

    <span class="hl kwa">def</span> <span class="hl kwd">registerInitialState</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        <span class="hl str">&quot;Initializes beliefs and inference modules&quot;</span>
        <span class="hl kwa">for</span> inference <span class="hl kwa">in</span> self<span class="hl opt">.</span>inferenceModules<span class="hl opt">:</span> inference<span class="hl opt">.</span><span class="hl kwd">initialize</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
        self<span class="hl opt">.</span>ghostBeliefs <span class="hl opt">= [</span>inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">()</span> <span class="hl kwa">for</span> inf <span class="hl kwa">in</span> self<span class="hl opt">.</span>inferenceModules<span class="hl opt">]</span>
        self<span class="hl opt">.</span>firstMove <span class="hl opt">=</span> <span class="hl kwa">True</span>
        self<span class="hl opt">.</span>answerList<span class="hl opt">.</span><span class="hl kwd">append</span><span class="hl opt">((</span>self<span class="hl opt">.</span>numMoves<span class="hl opt">,</span><span class="hl kwa">None</span><span class="hl opt">,</span>copy<span class="hl opt">.</span><span class="hl kwd">deepcopy</span><span class="hl opt">(</span>self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">)))</span>

    <span class="hl kwa">def</span> <span class="hl kwd">getAction</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        <span class="hl str">&quot;Updates beliefs, then chooses an action based on updated beliefs.&quot;</span>
        distributionList <span class="hl opt">= []</span>
        self<span class="hl opt">.</span>numMoves <span class="hl opt">+=</span> <span class="hl num">1</span>
        <span class="hl kwa">for</span> index<span class="hl opt">,</span>inf <span class="hl kwa">in</span> <span class="hl kwb">enumerate</span><span class="hl opt">(</span>self<span class="hl opt">.</span>inferenceModules<span class="hl opt">):</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>elapse<span class="hl opt">:</span>
                <span class="hl kwa">if not</span> self<span class="hl opt">.</span>firstMove<span class="hl opt">:</span> inf<span class="hl opt">.</span><span class="hl kwd">elapseTime</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
            self<span class="hl opt">.</span>firstMove <span class="hl opt">=</span> <span class="hl kwa">False</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>observe<span class="hl opt">:</span>
                inf<span class="hl opt">.</span><span class="hl kwd">observeState</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
            self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">[</span>index<span class="hl opt">] =</span> inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">()</span>
            beliefCopy <span class="hl opt">=</span> copy<span class="hl opt">.</span><span class="hl kwd">deepcopy</span><span class="hl opt">(</span>self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">[</span>index<span class="hl opt">])</span>
            distributionList<span class="hl opt">.</span><span class="hl kwd">append</span><span class="hl opt">(</span>beliefCopy<span class="hl opt">)</span>
        action <span class="hl opt">=</span> random<span class="hl opt">.</span><span class="hl kwd">choice</span><span class="hl opt">([</span>a <span class="hl kwa">for</span> a <span class="hl kwa">in</span> gameState<span class="hl opt">.</span><span class="hl kwd">getLegalPacmanActions</span><span class="hl opt">()</span> <span class="hl kwa">if</span> a <span class="hl opt">!=</span> <span class="hl str">'STOP'</span><span class="hl opt">])</span>
        self<span class="hl opt">.</span>answerList<span class="hl opt">.</span><span class="hl kwd">append</span><span class="hl opt">((</span>self<span class="hl opt">.</span>numMoves<span class="hl opt">,</span> action<span class="hl opt">,</span> distributionList<span class="hl opt">))</span>
        random<span class="hl opt">.</span><span class="hl kwd">seed</span><span class="hl opt">(</span>self<span class="hl opt">.</span>seed <span class="hl opt">+</span> self<span class="hl opt">.</span>numMoves<span class="hl opt">)</span>
        <span class="hl kwa">return</span> action


<span class="hl kwa">class</span> <span class="hl kwd">ZeroWeightAgent</span><span class="hl opt">(</span>bustersAgents<span class="hl opt">.</span>BustersAgent<span class="hl opt">):</span>
    <span class="hl str">&quot;Tracks ghosts and compares to reference inference modules, while moving randomly&quot;</span>

    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span> self<span class="hl opt">,</span> inference<span class="hl opt">,</span> ghostAgents<span class="hl opt">,</span> grades<span class="hl opt">,</span> seed<span class="hl opt">,</span> disp<span class="hl opt">,</span> elapse<span class="hl opt">=</span><span class="hl kwa">True</span><span class="hl opt">,</span> observe<span class="hl opt">=</span><span class="hl kwa">True</span> <span class="hl opt">):</span>
        self<span class="hl opt">.</span>inferenceModules <span class="hl opt">= [</span><span class="hl kwd">inference</span><span class="hl opt">(</span>a<span class="hl opt">)</span> <span class="hl kwa">for</span> a <span class="hl kwa">in</span> ghostAgents<span class="hl opt">]</span>
        self<span class="hl opt">.</span>elapse <span class="hl opt">=</span> elapse
        self<span class="hl opt">.</span>observe <span class="hl opt">=</span> observe
        self<span class="hl opt">.</span>grades <span class="hl opt">=</span> grades
        self<span class="hl opt">.</span>numMoves <span class="hl opt">=</span> <span class="hl num">0</span>
        self<span class="hl opt">.</span>seed <span class="hl opt">=</span> seed
        self<span class="hl opt">.</span>display <span class="hl opt">=</span> disp
        self<span class="hl opt">.</span>reset <span class="hl opt">=</span> <span class="hl kwa">False</span>

    <span class="hl kwa">def</span> <span class="hl kwd">final</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        <span class="hl kwa">pass</span>

    <span class="hl kwa">def</span> <span class="hl kwd">registerInitialState</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        <span class="hl str">&quot;Initializes beliefs and inference modules&quot;</span>
        <span class="hl kwa">for</span> inference <span class="hl kwa">in</span> self<span class="hl opt">.</span>inferenceModules<span class="hl opt">:</span> inference<span class="hl opt">.</span><span class="hl kwd">initialize</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
        self<span class="hl opt">.</span>ghostBeliefs <span class="hl opt">= [</span>inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">()</span> <span class="hl kwa">for</span> inf <span class="hl kwa">in</span> self<span class="hl opt">.</span>inferenceModules<span class="hl opt">]</span>
        self<span class="hl opt">.</span>firstMove <span class="hl opt">=</span> <span class="hl kwa">True</span>

    <span class="hl kwa">def</span> <span class="hl kwd">getAction</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        <span class="hl str">&quot;Updates beliefs, then chooses an action based on updated beliefs.&quot;</span>
        newBeliefs <span class="hl opt">= [</span><span class="hl kwa">None</span><span class="hl opt">] *</span> <span class="hl kwb">len</span><span class="hl opt">(</span>self<span class="hl opt">.</span>inferenceModules<span class="hl opt">)</span>
        self<span class="hl opt">.</span>numMoves <span class="hl opt">+=</span> <span class="hl num">1</span>
        <span class="hl kwa">for</span> index<span class="hl opt">,</span>inf <span class="hl kwa">in</span> <span class="hl kwb">enumerate</span><span class="hl opt">(</span>self<span class="hl opt">.</span>inferenceModules<span class="hl opt">):</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>elapse<span class="hl opt">:</span>
                <span class="hl kwa">if not</span> self<span class="hl opt">.</span>firstMove<span class="hl opt">:</span> inf<span class="hl opt">.</span><span class="hl kwd">elapseTime</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
            self<span class="hl opt">.</span>firstMove <span class="hl opt">=</span> <span class="hl kwa">False</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>observe<span class="hl opt">:</span>
                inf<span class="hl opt">.</span><span class="hl kwd">observeState</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
            newBeliefs<span class="hl opt">[</span>index<span class="hl opt">] =</span> inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">()</span>
        self<span class="hl opt">.</span><span class="hl kwd">checkReset</span><span class="hl opt">(</span>newBeliefs<span class="hl opt">,</span> self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">)</span>
        self<span class="hl opt">.</span>ghostBeliefs <span class="hl opt">=</span> newBeliefs
        self<span class="hl opt">.</span>display<span class="hl opt">.</span><span class="hl kwd">updateDistributions</span><span class="hl opt">(</span>self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">)</span>
        random<span class="hl opt">.</span><span class="hl kwd">seed</span><span class="hl opt">(</span>self<span class="hl opt">.</span>seed <span class="hl opt">+</span> self<span class="hl opt">.</span>numMoves<span class="hl opt">)</span>
        action <span class="hl opt">=</span> random<span class="hl opt">.</span><span class="hl kwd">choice</span><span class="hl opt">([</span>a <span class="hl kwa">for</span> a <span class="hl kwa">in</span> gameState<span class="hl opt">.</span><span class="hl kwd">getLegalPacmanActions</span><span class="hl opt">()</span> <span class="hl kwa">if</span> a <span class="hl opt">!=</span> <span class="hl str">'STOP'</span><span class="hl opt">])</span>
        <span class="hl kwa">return</span> action

    <span class="hl kwa">def</span> <span class="hl kwd">checkReset</span><span class="hl opt">(</span>self<span class="hl opt">,</span> newBeliefs<span class="hl opt">,</span> oldBeliefs<span class="hl opt">):</span>
        <span class="hl kwa">for</span> i <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span><span class="hl kwb">len</span><span class="hl opt">(</span>newBeliefs<span class="hl opt">)):</span>
            newKeys <span class="hl opt">=</span> <span class="hl kwb">filter</span><span class="hl opt">(</span><span class="hl kwa">lambda</span> x<span class="hl opt">:</span> newBeliefs<span class="hl opt">[</span>i<span class="hl opt">][</span>x<span class="hl opt">] !=</span> <span class="hl num">0</span><span class="hl opt">,</span> newBeliefs<span class="hl opt">[</span>i<span class="hl opt">].</span><span class="hl kwd">keys</span><span class="hl opt">())</span>
            oldKeys <span class="hl opt">=</span> <span class="hl kwb">filter</span><span class="hl opt">(</span><span class="hl kwa">lambda</span> x<span class="hl opt">:</span> oldBeliefs<span class="hl opt">[</span>i<span class="hl opt">][</span>x<span class="hl opt">] !=</span> <span class="hl num">0</span><span class="hl opt">,</span> oldBeliefs<span class="hl opt">[</span>i<span class="hl opt">].</span><span class="hl kwd">keys</span><span class="hl opt">())</span>
            <span class="hl kwa">if</span> <span class="hl kwb">len</span><span class="hl opt">(</span>newKeys<span class="hl opt">) &gt;</span> <span class="hl kwb">len</span><span class="hl opt">(</span>oldKeys<span class="hl opt">):</span>
                self<span class="hl opt">.</span>reset <span class="hl opt">=</span> <span class="hl kwa">True</span>

    <span class="hl kwa">def</span> <span class="hl kwd">getReset</span><span class="hl opt">(</span>self<span class="hl opt">):</span>
        <span class="hl kwa">return</span> self<span class="hl opt">.</span>reset


<span class="hl kwa">class</span> <span class="hl kwd">DoubleInferenceAgent</span><span class="hl opt">(</span>bustersAgents<span class="hl opt">.</span>BustersAgent<span class="hl opt">):</span>
    <span class="hl str">&quot;Tracks ghosts and compares to reference inference modules, while moving randomly&quot;</span>

    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span> self<span class="hl opt">,</span> inference<span class="hl opt">,</span> refSolution<span class="hl opt">,</span> ghostAgents<span class="hl opt">,</span> grades<span class="hl opt">,</span> seed<span class="hl opt">,</span> disp<span class="hl opt">,</span> elapse<span class="hl opt">=</span><span class="hl kwa">True</span><span class="hl opt">,</span> observe<span class="hl opt">=</span><span class="hl kwa">True</span><span class="hl opt">,</span> L2Tolerance<span class="hl opt">=</span><span class="hl num">0.2</span><span class="hl opt">,</span> burnIn<span class="hl opt">=</span><span class="hl num">0</span><span class="hl opt">,</span> checkUniform <span class="hl opt">=</span> <span class="hl kwa">False</span><span class="hl opt">):</span>
        self<span class="hl opt">.</span>inferenceModules <span class="hl opt">= [</span><span class="hl kwd">inference</span><span class="hl opt">(</span>a<span class="hl opt">)</span> <span class="hl kwa">for</span> a <span class="hl kwa">in</span> ghostAgents<span class="hl opt">]</span>
        self<span class="hl opt">.</span>refSolution <span class="hl opt">=</span> refSolution
        self<span class="hl opt">.</span>elapse <span class="hl opt">=</span> elapse
        self<span class="hl opt">.</span>observe <span class="hl opt">=</span> observe
        self<span class="hl opt">.</span>grades <span class="hl opt">=</span> grades
        self<span class="hl opt">.</span>L2Tolerance <span class="hl opt">=</span> L2Tolerance
        self<span class="hl opt">.</span>errors <span class="hl opt">=</span> <span class="hl num">0</span>
        self<span class="hl opt">.</span>burnIn <span class="hl opt">=</span> burnIn
        self<span class="hl opt">.</span>numMoves <span class="hl opt">=</span> <span class="hl num">0</span>
        self<span class="hl opt">.</span>seed <span class="hl opt">=</span> seed
        self<span class="hl opt">.</span>display <span class="hl opt">=</span> disp
        self<span class="hl opt">.</span>checkUniform <span class="hl opt">=</span> checkUniform

    <span class="hl kwa">def</span> <span class="hl kwd">final</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        self<span class="hl opt">.</span>numMoves <span class="hl opt">+=</span> <span class="hl num">1</span>
        moveNum<span class="hl opt">,</span>action<span class="hl opt">,</span>dists <span class="hl opt">=</span> self<span class="hl opt">.</span>refSolution<span class="hl opt">[</span>self<span class="hl opt">.</span>numMoves<span class="hl opt">]</span>
        <span class="hl kwa">for</span> index<span class="hl opt">,</span>inf <span class="hl kwa">in</span> <span class="hl kwb">enumerate</span><span class="hl opt">(</span>self<span class="hl opt">.</span>inferenceModules<span class="hl opt">):</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>observe<span class="hl opt">:</span>
                inf<span class="hl opt">.</span><span class="hl kwd">observeState</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
            self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">[</span>index<span class="hl opt">] =</span> inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">()</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>numMoves <span class="hl opt">&gt;=</span> self<span class="hl opt">.</span>burnIn<span class="hl opt">:</span>
                self<span class="hl opt">.</span><span class="hl kwd">distCompare</span><span class="hl opt">(</span>self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">[</span>index<span class="hl opt">],</span> dists<span class="hl opt">[</span>index<span class="hl opt">])</span>
        self<span class="hl opt">.</span>display<span class="hl opt">.</span><span class="hl kwd">updateDistributions</span><span class="hl opt">(</span>self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">)</span>
        random<span class="hl opt">.</span><span class="hl kwd">seed</span><span class="hl opt">(</span>self<span class="hl opt">.</span>seed <span class="hl opt">+</span> self<span class="hl opt">.</span>numMoves<span class="hl opt">)</span>
        <span class="hl kwa">if not</span> self<span class="hl opt">.</span>display<span class="hl opt">.</span><span class="hl kwd">checkNullDisplay</span><span class="hl opt">():</span>
            time<span class="hl opt">.</span><span class="hl kwd">sleep</span><span class="hl opt">(</span><span class="hl num">3</span><span class="hl opt">)</span>

    <span class="hl kwa">def</span> <span class="hl kwd">registerInitialState</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        <span class="hl str">&quot;Initializes beliefs and inference modules&quot;</span>
        <span class="hl kwa">for</span> inference <span class="hl kwa">in</span> self<span class="hl opt">.</span>inferenceModules<span class="hl opt">:</span> inference<span class="hl opt">.</span><span class="hl kwd">initialize</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
        moveNum<span class="hl opt">,</span>action<span class="hl opt">,</span>dists <span class="hl opt">=</span> self<span class="hl opt">.</span>refSolution<span class="hl opt">[</span>self<span class="hl opt">.</span>numMoves<span class="hl opt">]</span>
        <span class="hl kwa">for</span> index<span class="hl opt">,</span>inf <span class="hl kwa">in</span> <span class="hl kwb">enumerate</span><span class="hl opt">(</span>self<span class="hl opt">.</span>inferenceModules<span class="hl opt">):</span>
            self<span class="hl opt">.</span><span class="hl kwd">distCompare</span><span class="hl opt">(</span>inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">(),</span> dists<span class="hl opt">[</span>index<span class="hl opt">])</span>
        self<span class="hl opt">.</span>ghostBeliefs <span class="hl opt">= [</span>inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">()</span> <span class="hl kwa">for</span> inf <span class="hl kwa">in</span> self<span class="hl opt">.</span>inferenceModules<span class="hl opt">]</span>
        self<span class="hl opt">.</span>firstMove <span class="hl opt">=</span> <span class="hl kwa">True</span>

    <span class="hl kwa">def</span> <span class="hl kwd">getAction</span><span class="hl opt">(</span>self<span class="hl opt">,</span> gameState<span class="hl opt">):</span>
        <span class="hl str">&quot;Updates beliefs, then chooses an action based on updated beliefs.&quot;</span>
        self<span class="hl opt">.</span>numMoves <span class="hl opt">+=</span> <span class="hl num">1</span>
        moveNum<span class="hl opt">,</span>action<span class="hl opt">,</span>dists <span class="hl opt">=</span> self<span class="hl opt">.</span>refSolution<span class="hl opt">[</span>self<span class="hl opt">.</span>numMoves<span class="hl opt">]</span>
        <span class="hl kwa">for</span> index<span class="hl opt">,</span>inf <span class="hl kwa">in</span> <span class="hl kwb">enumerate</span><span class="hl opt">(</span>self<span class="hl opt">.</span>inferenceModules<span class="hl opt">):</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>elapse<span class="hl opt">:</span>
                <span class="hl kwa">if not</span> self<span class="hl opt">.</span>firstMove<span class="hl opt">:</span> inf<span class="hl opt">.</span><span class="hl kwd">elapseTime</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
            self<span class="hl opt">.</span>firstMove <span class="hl opt">=</span> <span class="hl kwa">False</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>observe<span class="hl opt">:</span>
                inf<span class="hl opt">.</span><span class="hl kwd">observeState</span><span class="hl opt">(</span>gameState<span class="hl opt">)</span>
            self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">[</span>index<span class="hl opt">] =</span> inf<span class="hl opt">.</span><span class="hl kwd">getBeliefDistribution</span><span class="hl opt">()</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>numMoves <span class="hl opt">&gt;=</span> self<span class="hl opt">.</span>burnIn<span class="hl opt">:</span> self<span class="hl opt">.</span><span class="hl kwd">distCompare</span><span class="hl opt">(</span>self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">[</span>index<span class="hl opt">],</span> dists<span class="hl opt">[</span>index<span class="hl opt">])</span>
        self<span class="hl opt">.</span>display<span class="hl opt">.</span><span class="hl kwd">updateDistributions</span><span class="hl opt">(</span>self<span class="hl opt">.</span>ghostBeliefs<span class="hl opt">)</span>
        random<span class="hl opt">.</span><span class="hl kwd">seed</span><span class="hl opt">(</span>self<span class="hl opt">.</span>seed <span class="hl opt">+</span> self<span class="hl opt">.</span>numMoves<span class="hl opt">)</span>
        <span class="hl kwa">return</span> action

    <span class="hl kwa">def</span> <span class="hl kwd">distCompare</span><span class="hl opt">(</span>self<span class="hl opt">,</span> dist<span class="hl opt">,</span> refDist<span class="hl opt">):</span>
        <span class="hl str">&quot;Compares two distributions&quot;</span>
        <span class="hl slc"># copy and prepare distributions</span>
        dist <span class="hl opt">=</span> dist<span class="hl opt">.</span><span class="hl kwd">copy</span><span class="hl opt">()</span>
        refDist <span class="hl opt">=</span> refDist<span class="hl opt">.</span><span class="hl kwd">copy</span><span class="hl opt">()</span>
        <span class="hl kwa">for</span> key <span class="hl kwa">in</span> <span class="hl kwb">set</span><span class="hl opt">(</span>refDist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">() +</span> dist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">()):</span>
            <span class="hl kwa">if not</span> key <span class="hl kwa">in</span> dist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">():</span>
                dist<span class="hl opt">[</span>key<span class="hl opt">] =</span> <span class="hl num">0.0</span>
            <span class="hl kwa">if not</span> key <span class="hl kwa">in</span> refDist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">():</span>
                refDist<span class="hl opt">[</span>key<span class="hl opt">] =</span> <span class="hl num">0.0</span>
        <span class="hl slc"># calculate l2 difference</span>
        l2 <span class="hl opt">=</span> <span class="hl num">0</span>
        <span class="hl kwa">for</span> k <span class="hl kwa">in</span> refDist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">():</span>
            l2 <span class="hl opt">+= (</span>dist<span class="hl opt">[</span>k<span class="hl opt">] -</span> refDist<span class="hl opt">[</span>k<span class="hl opt">]) **</span> <span class="hl num">2</span>
        <span class="hl kwa">if</span> l2 <span class="hl opt">&gt;</span> self<span class="hl opt">.</span>L2Tolerance<span class="hl opt">:</span>
            <span class="hl kwa">if</span> self<span class="hl opt">.</span>errors <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl opt">:</span>
                t <span class="hl opt">= (</span>self<span class="hl opt">.</span>grades<span class="hl opt">.</span>currentQuestion<span class="hl opt">,</span> self<span class="hl opt">.</span>numMoves<span class="hl opt">,</span> l2<span class="hl opt">)</span>
                summary <span class="hl opt">=</span> <span class="hl str">&quot;%s) Distribution deviated at move %d by %0.4f (squared norm) from the correct answer.</span><span class="hl esc">\n</span><span class="hl str">&quot;</span> <span class="hl opt">%</span> t
                header <span class="hl opt">=</span> <span class="hl str">'%10s%5s%-25s%-25s</span><span class="hl esc">\n</span><span class="hl str">'</span> <span class="hl opt">% (</span><span class="hl str">'key:'</span><span class="hl opt">,</span> <span class="hl str">''</span><span class="hl opt">,</span> <span class="hl str">'student'</span><span class="hl opt">,</span> <span class="hl str">'reference'</span><span class="hl opt">)</span>
                detail <span class="hl opt">=</span> <span class="hl str">'</span><span class="hl esc">\n</span><span class="hl str">'</span><span class="hl opt">.</span><span class="hl kwd">join</span><span class="hl opt">(</span><span class="hl kwb">map</span><span class="hl opt">(</span><span class="hl kwa">lambda</span> x<span class="hl opt">:</span> <span class="hl str">'%9s:%5s%-25s%-25s'</span> <span class="hl opt">% (</span>x<span class="hl opt">,</span> <span class="hl str">''</span><span class="hl opt">,</span> dist<span class="hl opt">[</span>x<span class="hl opt">],</span> refDist<span class="hl opt">[</span>x<span class="hl opt">]),</span> <span class="hl kwb">set</span><span class="hl opt">(</span>dist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">() +</span> refDist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">())))</span>
                self<span class="hl opt">.</span>grades<span class="hl opt">.</span><span class="hl kwd">fail</span><span class="hl opt">(</span><span class="hl str">'%s%s%s'</span> <span class="hl opt">% (</span>summary<span class="hl opt">,</span> header<span class="hl opt">,</span> detail<span class="hl opt">))</span>
            self<span class="hl opt">.</span>errors <span class="hl opt">+=</span> <span class="hl num">1</span>
        <span class="hl slc"># check for uniform distribution if necessary</span>
        <span class="hl kwa">if</span> self<span class="hl opt">.</span>checkUniform<span class="hl opt">:</span>
            <span class="hl kwa">if</span> <span class="hl kwb">abs</span><span class="hl opt">(</span><span class="hl kwb">max</span><span class="hl opt">(</span>dist<span class="hl opt">.</span><span class="hl kwd">values</span><span class="hl opt">()) -</span> <span class="hl kwb">max</span><span class="hl opt">(</span>refDist<span class="hl opt">.</span><span class="hl kwd">values</span><span class="hl opt">())) &gt;</span> <span class="hl num">.0025</span><span class="hl opt">:</span>
                <span class="hl kwa">if</span> self<span class="hl opt">.</span>errors <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl opt">:</span>
                    self<span class="hl opt">.</span>grades<span class="hl opt">.</span><span class="hl kwd">fail</span><span class="hl opt">(</span><span class="hl str">'%s) Distributions do not have the same max value and are therefore not uniform.</span><span class="hl esc">\n\t</span><span class="hl str">student max: %f</span><span class="hl esc">\n\t</span><span class="hl str">reference max: %f'</span> <span class="hl opt">% (</span>self<span class="hl opt">.</span>grades<span class="hl opt">.</span>currentQuestion<span class="hl opt">,</span> <span class="hl kwb">max</span><span class="hl opt">(</span>dist<span class="hl opt">.</span><span class="hl kwd">values</span><span class="hl opt">()),</span> <span class="hl kwb">max</span><span class="hl opt">(</span>refDist<span class="hl opt">.</span><span class="hl kwd">values</span><span class="hl opt">())))</span>
                    self<span class="hl opt">.</span>errors <span class="hl opt">+=</span> <span class="hl num">1</span>

<span class="hl kwa">class</span> <span class="hl kwd">SeededRandomGhostAgent</span><span class="hl opt">(</span>Agent<span class="hl opt">):</span>
    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span>self<span class="hl opt">,</span> index<span class="hl opt">):</span>
        self<span class="hl opt">.</span>index <span class="hl opt">=</span> index<span class="hl opt">;</span>

    <span class="hl kwa">def</span> <span class="hl kwd">getAction</span><span class="hl opt">(</span>self<span class="hl opt">,</span> state<span class="hl opt">):</span>
        dist <span class="hl opt">=</span> util<span class="hl opt">.</span><span class="hl kwd">Counter</span><span class="hl opt">()</span>
        <span class="hl kwa">for</span> a <span class="hl kwa">in</span> state<span class="hl opt">.</span><span class="hl kwd">getLegalActions</span><span class="hl opt">(</span> self<span class="hl opt">.</span>index <span class="hl opt">):</span> dist<span class="hl opt">[</span>a<span class="hl opt">] =</span> <span class="hl num">1.0</span>
        dist<span class="hl opt">.</span><span class="hl kwd">normalize</span><span class="hl opt">()</span>
        <span class="hl kwa">if</span> <span class="hl kwb">len</span><span class="hl opt">(</span>dist<span class="hl opt">) ==</span> <span class="hl num">0</span><span class="hl opt">:</span>
            <span class="hl kwa">return</span> Directions<span class="hl opt">.</span>STOP
        <span class="hl kwa">else</span><span class="hl opt">:</span>
            action <span class="hl opt">=</span> self<span class="hl opt">.</span><span class="hl kwd">sample</span><span class="hl opt">(</span> dist <span class="hl opt">)</span>
            <span class="hl kwa">return</span> action

    <span class="hl kwa">def</span> <span class="hl kwd">getDistribution</span><span class="hl opt">(</span> self<span class="hl opt">,</span> state <span class="hl opt">):</span>
        dist <span class="hl opt">=</span> util<span class="hl opt">.</span><span class="hl kwd">Counter</span><span class="hl opt">()</span>
        <span class="hl kwa">for</span> a <span class="hl kwa">in</span> state<span class="hl opt">.</span><span class="hl kwd">getLegalActions</span><span class="hl opt">(</span> self<span class="hl opt">.</span>index <span class="hl opt">):</span> dist<span class="hl opt">[</span>a<span class="hl opt">] =</span> <span class="hl num">1.0</span>
        dist<span class="hl opt">.</span><span class="hl kwd">normalize</span><span class="hl opt">()</span>
        <span class="hl kwa">return</span> dist

    <span class="hl kwa">def</span> <span class="hl kwd">sample</span><span class="hl opt">(</span>self<span class="hl opt">,</span> distribution<span class="hl opt">,</span> values <span class="hl opt">=</span> <span class="hl kwa">None</span><span class="hl opt">):</span>
        <span class="hl kwa">if</span> <span class="hl kwb">type</span><span class="hl opt">(</span>distribution<span class="hl opt">) ==</span> util<span class="hl opt">.</span>Counter<span class="hl opt">:</span>
            items <span class="hl opt">=</span> distribution<span class="hl opt">.</span><span class="hl kwd">items</span><span class="hl opt">()</span>
            distribution <span class="hl opt">= [</span>i<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">]</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> items<span class="hl opt">]</span>
            values <span class="hl opt">= [</span>i<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">]</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> items<span class="hl opt">]</span>
        <span class="hl kwa">if</span> <span class="hl kwb">sum</span><span class="hl opt">(</span>distribution<span class="hl opt">) !=</span> <span class="hl num">1</span><span class="hl opt">:</span>
            distribution <span class="hl opt">=</span> <span class="hl kwd">normalize</span><span class="hl opt">(</span>distribution<span class="hl opt">)</span>
        choice <span class="hl opt">=</span> random<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()</span>
        i<span class="hl opt">,</span> total<span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">,</span> distribution<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">]</span>
        <span class="hl kwa">while</span> choice <span class="hl opt">&gt;</span> total<span class="hl opt">:</span>
            i <span class="hl opt">+=</span> <span class="hl num">1</span>
            total <span class="hl opt">+=</span> distribution<span class="hl opt">[</span>i<span class="hl opt">]</span>
        <span class="hl kwa">return</span> values<span class="hl opt">[</span>i<span class="hl opt">]</span>

<span class="hl kwa">class</span> <span class="hl kwd">GoSouthAgent</span><span class="hl opt">(</span>Agent<span class="hl opt">):</span>
    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span>self<span class="hl opt">,</span> index<span class="hl opt">):</span>
        self<span class="hl opt">.</span>index <span class="hl opt">=</span> index<span class="hl opt">;</span>

    <span class="hl kwa">def</span> <span class="hl kwd">getAction</span><span class="hl opt">(</span>self<span class="hl opt">,</span> state<span class="hl opt">):</span>
        dist <span class="hl opt">=</span> util<span class="hl opt">.</span><span class="hl kwd">Counter</span><span class="hl opt">()</span>
        <span class="hl kwa">for</span> a <span class="hl kwa">in</span> state<span class="hl opt">.</span><span class="hl kwd">getLegalActions</span><span class="hl opt">(</span> self<span class="hl opt">.</span>index <span class="hl opt">):</span>
            dist<span class="hl opt">[</span>a<span class="hl opt">] =</span> <span class="hl num">1.0</span>
        <span class="hl kwa">if</span> Directions<span class="hl opt">.</span>SOUTH <span class="hl kwa">in</span> dist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">():</span>
            dist<span class="hl opt">[</span>Directions<span class="hl opt">.</span>SOUTH<span class="hl opt">] *=</span> <span class="hl num">2</span>
        dist<span class="hl opt">.</span><span class="hl kwd">normalize</span><span class="hl opt">()</span>
        <span class="hl kwa">if</span> <span class="hl kwb">len</span><span class="hl opt">(</span>dist<span class="hl opt">) ==</span> <span class="hl num">0</span><span class="hl opt">:</span>
            <span class="hl kwa">return</span> Directions<span class="hl opt">.</span>STOP
        <span class="hl kwa">else</span><span class="hl opt">:</span>
            action <span class="hl opt">=</span> self<span class="hl opt">.</span><span class="hl kwd">sample</span><span class="hl opt">(</span> dist <span class="hl opt">)</span>
            <span class="hl kwa">return</span> action

    <span class="hl kwa">def</span> <span class="hl kwd">getDistribution</span><span class="hl opt">(</span> self<span class="hl opt">,</span> state <span class="hl opt">):</span>
        dist <span class="hl opt">=</span> util<span class="hl opt">.</span><span class="hl kwd">Counter</span><span class="hl opt">()</span>
        <span class="hl kwa">for</span> a <span class="hl kwa">in</span> state<span class="hl opt">.</span><span class="hl kwd">getLegalActions</span><span class="hl opt">(</span> self<span class="hl opt">.</span>index <span class="hl opt">):</span>
            dist<span class="hl opt">[</span>a<span class="hl opt">] =</span> <span class="hl num">1.0</span>
        <span class="hl kwa">if</span> Directions<span class="hl opt">.</span>SOUTH <span class="hl kwa">in</span> dist<span class="hl opt">.</span><span class="hl kwd">keys</span><span class="hl opt">():</span>
            dist<span class="hl opt">[</span>Directions<span class="hl opt">.</span>SOUTH<span class="hl opt">] *=</span> <span class="hl num">2</span>
        dist<span class="hl opt">.</span><span class="hl kwd">normalize</span><span class="hl opt">()</span>
        <span class="hl kwa">return</span> dist

    <span class="hl kwa">def</span> <span class="hl kwd">sample</span><span class="hl opt">(</span>self<span class="hl opt">,</span> distribution<span class="hl opt">,</span> values <span class="hl opt">=</span> <span class="hl kwa">None</span><span class="hl opt">):</span>
        <span class="hl kwa">if</span> <span class="hl kwb">type</span><span class="hl opt">(</span>distribution<span class="hl opt">) ==</span> util<span class="hl opt">.</span>Counter<span class="hl opt">:</span>
            items <span class="hl opt">=</span> distribution<span class="hl opt">.</span><span class="hl kwd">items</span><span class="hl opt">()</span>
            distribution <span class="hl opt">= [</span>i<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">]</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> items<span class="hl opt">]</span>
            values <span class="hl opt">= [</span>i<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">]</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> items<span class="hl opt">]</span>
        <span class="hl kwa">if</span> <span class="hl kwb">sum</span><span class="hl opt">(</span>distribution<span class="hl opt">) !=</span> <span class="hl num">1</span><span class="hl opt">:</span>
            distribution <span class="hl opt">=</span> util<span class="hl opt">.</span><span class="hl kwd">normalize</span><span class="hl opt">(</span>distribution<span class="hl opt">)</span>
        choice <span class="hl opt">=</span> random<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()</span>
        i<span class="hl opt">,</span> total<span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">,</span> distribution<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">]</span>
        <span class="hl kwa">while</span> choice <span class="hl opt">&gt;</span> total<span class="hl opt">:</span>
            i <span class="hl opt">+=</span> <span class="hl num">1</span>
            total <span class="hl opt">+=</span> distribution<span class="hl opt">[</span>i<span class="hl opt">]</span>
        <span class="hl kwa">return</span> values<span class="hl opt">[</span>i<span class="hl opt">]</span>

<span class="hl kwa">class</span> <span class="hl kwd">DispersingSeededGhost</span><span class="hl opt">(</span> Agent<span class="hl opt">):</span>
    <span class="hl str">&quot;Chooses an action that distances the ghost from the other ghosts with probability spreadProb.&quot;</span>
    <span class="hl kwa">def</span> <span class="hl kwd">__init__</span><span class="hl opt">(</span> self<span class="hl opt">,</span> index<span class="hl opt">,</span> spreadProb<span class="hl opt">=</span><span class="hl num">0.5</span><span class="hl opt">):</span>
        self<span class="hl opt">.</span>index <span class="hl opt">=</span> index
        self<span class="hl opt">.</span>spreadProb <span class="hl opt">=</span> spreadProb

    <span class="hl kwa">def</span> <span class="hl kwd">getAction</span><span class="hl opt">(</span>self<span class="hl opt">,</span> state<span class="hl opt">):</span>
        dist <span class="hl opt">=</span> self<span class="hl opt">.</span><span class="hl kwd">getDistribution</span><span class="hl opt">(</span>state<span class="hl opt">);</span>
        <span class="hl kwa">if</span> <span class="hl kwb">len</span><span class="hl opt">(</span>dist<span class="hl opt">) ==</span> <span class="hl num">0</span><span class="hl opt">:</span>
            <span class="hl kwa">return</span> Directions<span class="hl opt">.</span>STOP
        <span class="hl kwa">else</span><span class="hl opt">:</span>
            action <span class="hl opt">=</span> self<span class="hl opt">.</span><span class="hl kwd">sample</span><span class="hl opt">(</span> dist <span class="hl opt">)</span>
            <span class="hl kwa">return</span> action

    <span class="hl kwa">def</span> <span class="hl kwd">getDistribution</span><span class="hl opt">(</span> self<span class="hl opt">,</span> state <span class="hl opt">):</span>
        ghostState <span class="hl opt">=</span> state<span class="hl opt">.</span><span class="hl kwd">getGhostState</span><span class="hl opt">(</span> self<span class="hl opt">.</span>index <span class="hl opt">)</span>
        legalActions <span class="hl opt">=</span> state<span class="hl opt">.</span><span class="hl kwd">getLegalActions</span><span class="hl opt">(</span> self<span class="hl opt">.</span>index <span class="hl opt">)</span>
        pos <span class="hl opt">=</span> state<span class="hl opt">.</span><span class="hl kwd">getGhostPosition</span><span class="hl opt">(</span> self<span class="hl opt">.</span>index <span class="hl opt">)</span>
        isScared <span class="hl opt">=</span> ghostState<span class="hl opt">.</span>scaredTimer <span class="hl opt">&gt;</span> <span class="hl num">0</span>

        speed <span class="hl opt">=</span> <span class="hl num">1</span>
        <span class="hl kwa">if</span> isScared<span class="hl opt">:</span> speed <span class="hl opt">=</span> <span class="hl num">0.5</span>
        actionVectors <span class="hl opt">= [</span>Actions<span class="hl opt">.</span><span class="hl kwd">directionToVector</span><span class="hl opt">(</span> a<span class="hl opt">,</span> speed <span class="hl opt">)</span> <span class="hl kwa">for</span> a <span class="hl kwa">in</span> legalActions<span class="hl opt">]</span>
        newPositions <span class="hl opt">= [(</span> pos<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">]+</span>a<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">],</span> pos<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">]+</span>a<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">] )</span> <span class="hl kwa">for</span> a <span class="hl kwa">in</span> actionVectors<span class="hl opt">]</span>

        <span class="hl slc"># get other ghost positions</span>
        others <span class="hl opt">= [</span>i <span class="hl kwa">for</span> i <span class="hl kwa">in</span> <span class="hl kwb">range</span><span class="hl opt">(</span><span class="hl num">1</span><span class="hl opt">,</span>state<span class="hl opt">.</span><span class="hl kwd">getNumAgents</span><span class="hl opt">())</span> <span class="hl kwa">if</span> i <span class="hl opt">!=</span> self<span class="hl opt">.</span>index<span class="hl opt">]</span>
        <span class="hl kwa">for</span> a <span class="hl kwa">in</span> others<span class="hl opt">:</span> <span class="hl kwa">assert</span> state<span class="hl opt">.</span><span class="hl kwd">getGhostState</span><span class="hl opt">(</span>a<span class="hl opt">) !=</span> <span class="hl kwa">None</span><span class="hl opt">,</span> <span class="hl str">&quot;Ghost position unspecified in state!&quot;</span>
        otherGhostPositions <span class="hl opt">= [</span>state<span class="hl opt">.</span><span class="hl kwd">getGhostPosition</span><span class="hl opt">(</span>a<span class="hl opt">)</span> <span class="hl kwa">for</span> a <span class="hl kwa">in</span> others <span class="hl kwa">if</span> state<span class="hl opt">.</span><span class="hl kwd">getGhostPosition</span><span class="hl opt">(</span>a<span class="hl opt">)[</span><span class="hl num">1</span><span class="hl opt">] &gt;</span> <span class="hl num">1</span><span class="hl opt">]</span>

        <span class="hl slc"># for each action, get the sum of inverse squared distances to the other ghosts</span>
        sumOfDistances <span class="hl opt">= []</span>
        <span class="hl kwa">for</span> pos <span class="hl kwa">in</span> newPositions<span class="hl opt">:</span>
            sumOfDistances<span class="hl opt">.</span><span class="hl kwd">append</span><span class="hl opt">(</span> <span class="hl kwb">sum</span><span class="hl opt">([(</span><span class="hl num">1</span><span class="hl opt">+</span><span class="hl kwd">manhattanDistance</span><span class="hl opt">(</span>pos<span class="hl opt">,</span> g<span class="hl opt">))**(-</span><span class="hl num">2</span><span class="hl opt">)</span> <span class="hl kwa">for</span> g <span class="hl kwa">in</span> otherGhostPositions<span class="hl opt">]) )</span>

        bestDistance <span class="hl opt">=</span> <span class="hl kwb">min</span><span class="hl opt">(</span>sumOfDistances<span class="hl opt">)</span>
        numBest <span class="hl opt">= [</span>bestDistance <span class="hl opt">==</span> dist <span class="hl kwa">for</span> dist <span class="hl kwa">in</span> sumOfDistances<span class="hl opt">].</span><span class="hl kwd">count</span><span class="hl opt">(</span><span class="hl kwa">True</span><span class="hl opt">)</span>
        distribution <span class="hl opt">=</span> util<span class="hl opt">.</span><span class="hl kwd">Counter</span><span class="hl opt">()</span>
        <span class="hl kwa">for</span> action<span class="hl opt">,</span> distance <span class="hl kwa">in</span> <span class="hl kwb">zip</span><span class="hl opt">(</span>legalActions<span class="hl opt">,</span> sumOfDistances<span class="hl opt">):</span>
            <span class="hl kwa">if</span> distance <span class="hl opt">==</span> bestDistance<span class="hl opt">:</span> distribution<span class="hl opt">[</span>action<span class="hl opt">] +=</span> self<span class="hl opt">.</span>spreadProb <span class="hl opt">/</span> numBest
            distribution<span class="hl opt">[</span>action<span class="hl opt">] += (</span><span class="hl num">1</span> <span class="hl opt">-</span> self<span class="hl opt">.</span>spreadProb<span class="hl opt">) /</span> <span class="hl kwb">len</span><span class="hl opt">(</span>legalActions<span class="hl opt">)</span>
        <span class="hl kwa">return</span> distribution

    <span class="hl kwa">def</span> <span class="hl kwd">sample</span><span class="hl opt">(</span>self<span class="hl opt">,</span> distribution<span class="hl opt">,</span> values <span class="hl opt">=</span> <span class="hl kwa">None</span><span class="hl opt">):</span>
        <span class="hl kwa">if</span> <span class="hl kwb">type</span><span class="hl opt">(</span>distribution<span class="hl opt">) ==</span> util<span class="hl opt">.</span>Counter<span class="hl opt">:</span>
            items <span class="hl opt">=</span> distribution<span class="hl opt">.</span><span class="hl kwd">items</span><span class="hl opt">()</span>
            distribution <span class="hl opt">= [</span>i<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">]</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> items<span class="hl opt">]</span>
            values <span class="hl opt">= [</span>i<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">]</span> <span class="hl kwa">for</span> i <span class="hl kwa">in</span> items<span class="hl opt">]</span>
        <span class="hl kwa">if</span> <span class="hl kwb">sum</span><span class="hl opt">(</span>distribution<span class="hl opt">) !=</span> <span class="hl num">1</span><span class="hl opt">:</span>
            distribution <span class="hl opt">=</span> util<span class="hl opt">.</span><span class="hl kwd">normalize</span><span class="hl opt">(</span>distribution<span class="hl opt">)</span>
        choice <span class="hl opt">=</span> random<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()</span>
        i<span class="hl opt">,</span> total<span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">,</span> distribution<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">]</span>
        <span class="hl kwa">while</span> choice <span class="hl opt">&gt;</span> total<span class="hl opt">:</span>
            i <span class="hl opt">+=</span> <span class="hl num">1</span>
            total <span class="hl opt">+=</span> distribution<span class="hl opt">[</span>i<span class="hl opt">]</span>
        <span class="hl kwa">return</span> values<span class="hl opt">[</span>i<span class="hl opt">]</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 3.8, http://www.andre-simon.de/-->
